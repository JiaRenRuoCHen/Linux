部署Zabbix监控平台
1. 安装LNMP环境
2. 源码安装Zabbix
3.安装监控端主机，修改基本配置
4.初始化Zabbix监控Web页面
5.修改PHP配置文件，满足Zabbix需求
6.安装被监控端主机，修改基本配置


步骤一：部署监控服务器
1）安装LNMP环境
Zabbix监控管理控制台需要通过Web页面展示出来，并且还需要使用MySQL来存储数据，因此需要先为Zabbix准备基础LNMP环境。
	]# yum -y install gcc pcre-devel  openssl-devel
	]# tar -xf nginx-1.12.2.tar.gz
	]# cd nginx-1.12.2	
	nginx-1.12.2]# ./configure --with-http_ssl_module
	nginx-1.12.2]# make && make install
	]# yum -y install php php-mysql mariadb mariadb-devel mariadb-server
	]# yum -y  install  php-fpm-5.4.16-42.el7.x86_64.rpm


2）修改Nginx配置文件
配置Nginx支持PHP动态网站，因为有大量PHP脚本需要执行，因此还需要开启Nginx的各种fastcgi缓存，加速PHP脚本的执行速度。
	]# vim /usr/local/nginx/conf/nginx.conf

	http{
	… …
	    fastcgi_buffers 8 16k;                      //缓存php生成的页面内容，8个16k
	    fastcgi_buffer_size 32k;                      //缓存php生产的头部信息
	    fastcgi_connect_timeout 300;                 //连接PHP的超时时间
	    fastcgi_send_timeout 300;                     //发送请求的超时时间
	    fastcgi_read_timeout 300;                        //读取请求的超时时间
	location ~ \.php$ {
	                root           html;
 	               fastcgi_pass   127.0.0.1:9000;
 	               fastcgi_index  index.php;
 	               include        fastcgi.conf;
   	     }

3）启动服务
启动Nginx、PHP-FPM、MariaDB服务，关闭SELinux与防火墙。
	]# systemctl start  mariadb
	]# systemctl start  php-fpm
	]# /usr/local/nginx/sbin/nginx /sbin/nginx
	]# firewall-cmd --set-default-zone=trusted
	]# setenforce 0

4）客户端测试LNMP环境
服务器创建PHP测试页面，浏览器访问页面测试网页连通性。


步骤二：部署监控服务器Zabbix Server
1）源码安装Zabbix Server
多数源码包都是需要依赖包的，zabbix也一样，源码编译前需要先安装相关依赖包。
	]# yum -y install  net-snmp-devel curl-devel	//安装相关依赖包 
	yum -y install libevent-devel-2.0.21-4.el7.x86_64.rpm        //安装libevent-devel源码包
	]# tar -xf zabbix-3.4.4.tar.gz  		//解压Zabbix压缩文件
	]# cd zabbix-3.4.4 	进入Zabbix目录下
	]# ./configure  --enable-server --enable-proxy --enable-agent --with-mysql=/usr/bin/mysql_config \ --with-net-snmp --with-libcurl      //配置
	]# make && make install           //编译&&安装


	// --enable-server安装部署zabbix服务器端软件
	// --enable-agent安装部署zabbix被监控端软件
	// --enable-proxy安装部署zabbix代理相关软件
	// --with-mysql配置mysql_config路径
	// --with-net-snmp允许zabbix通过snmp协议监控其他设备
	// --with-libcurl安装相关curl库文件，这样zabbix就可以通过curl连接http等服务，测试被监控主机服务的状态


2）初始化Zabbix
创建数据库，恢复Zabbix的数据到数据库
	]# mysql
	mysql> create database zabbix character set utf8;		//创建数据库，支持中文字符集
	mysql> grant all on zabbix.* to zabbix@'localhost' identified by 'zabbix';	//创建可以访问数据库的账户与密码
	]# zabbix-3.4.4/database/mysql/	//zabbix目录下适合本机数据库的初始数据库文件
	]# mysql -uzabbix -pzabbix zabbix < schema.sql	//必须第一个恢复,不能打乱顺序
	]# mysql -uzabbix -pzabbix zabbix < images.sql	//必须第二个恢复
	]# mysql -uzabbix -pzabbix zabbix < data.sql	//必须第三个恢复


上线Zabbix的Web页面
	]# cd zabbix-3.4.4/frontends/php/		//zabbix目录下默认web页面
	]# cp -r * /usr/local/nginx/html/
	]# chmod -R 777 /usr/local/nginx/html/*

修改Zabbix_server配置文件，设置数据库相关参数，启动Zabbix_server服务
	]# vim /usr/local/etc/zabbix_server.conf
	DBHost=localhost		//数据库主机，默认该行被注释
	DBName=zabbix	//设置数据库名称
	DBUser=zabbix	//设置数据库账户
	DBPassword=zabbix		//设置数据库密码，默认该行被注释
	LogFile=/tmp/zabbix_server.log    	//设置日志，仅查看以下即可
	[root@zabbixserver ~]# useradd -s /sbin/nologin zabbix		//不创建用户无法启动服务
	]# zabbix_server                      //启动服务
	]# ss -ntulp |grep zabbix_server     //确认连接状态，端口10051
	提示：如果是因为配置文件不对，导致服务无法启动时，不要重复执行zabbix_server，一定要先使用killall zabbix_server关闭服务后，再重新启动一次。



修改PHP配置文件，满足Zabbix_server的Web环境要求
	]# yum -y install  php-gd php-xml php-ldqp
	]# yum install php-bcmath  
	]# yum install php-mbstring
	]# vim /etc/php.ini
	date.timezone = Asia/Shanghai                //设置时区
	max_execution_time = 300                    //最大执行时间，秒
	post_max_size = 32M                        //POST数据最大容量
	max_input_time = 300                        //服务器接收数据的时间限制
	memory_limit = 128M                        //内存容量限制
	]# systemctl restart php-fpm

修改Zabbix_agent配置文件，启动Zabbix_agent服务
	]# vim /usr/local/etc/zabbix_agentd.conf
	Server=127.0.0.1,192.168.2.5                    //允许哪些主机监控本机
	ServerActive=127.0.0.1,192.168.2.5                //允许哪些主机通过主动模式监控本机
	Hostname=zabbix_server                        //设置本机主机名
	LogFile=/tmp/zabbix_server.log                    //设置日志文件
	UnsafeUserParameters=1                        //是否允许自定义key
	]# zabbix_agentd            //启动监控agent


提示：如果是因为配置文件不对，导致服务无法启动时，不要重复执行zabbix_agentd，一定要先使用killall zabbix_agentd关闭服务后，再重新启动一次。浏览器访问Zabbix_server服务器的Web页面
	]# firefox http://192.168.2.5/index.php




















